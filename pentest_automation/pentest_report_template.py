from docx import Document
from docx.shared import Pt, RGBColor, Inches
from docx.oxml import OxmlElement
from docx.enum.text import WD_PARAGRAPH_ALIGNMENT

# Create a new Document
doc = Document()

# Set the margins of the document
sections = doc.sections
for section in sections:
    section.top_margin = Inches(1)
    section.bottom_margin = Inches(1)
    section.left_margin = Inches(1.25)
    section.right_margin = Inches(1.25)

# Add title page elements
doc.add_heading('Pentest Report', 0).alignment = WD_PARAGRAPH_ALIGNMENT.CENTER

doc.add_paragraph('Client Name', style='Title').alignment = WD_PARAGRAPH_ALIGNMENT.CENTER
doc.add_paragraph('Date of Report', style='Title').alignment = WD_PARAGRAPH_ALIGNMENT.CENTER
doc.add_paragraph('Your Name', style='Title').alignment = WD_PARAGRAPH_ALIGNMENT.CENTER
doc.add_paragraph('Pentester email', style='Title').alignment = WD_PARAGRAPH_ALIGNMENT.CENTER

# Add placeholder for the logo
doc.add_paragraph("\n[Placeholder for Logo]", style='Title').alignment = WD_PARAGRAPH_ALIGNMENT.CENTER

# Add a page break after the title page
doc.add_page_break()

# Add the Table of Contents placeholder
doc.add_paragraph('Table of Contents', style='Heading 1')
doc.add_paragraph('1. Executive Summary', style='Normal')
doc.add_paragraph('2. Methodology', style='Normal')
doc.add_paragraph('3. Findings and Vulnerabilities', style='Normal')
doc.add_paragraph('4. Impact of Vulnerabilities', style='Normal')
doc.add_paragraph('5. Recommendations', style='Normal')
doc.add_paragraph('6. Conclusion', style='Normal')
doc.add_paragraph('7. Contact Information', style='Normal')
doc.add_paragraph('8. Appendices (if applicable)', style='Normal')
doc.add_page_break()

# Executive Summary
doc.add_heading('Executive Summary', level=1)
doc.add_paragraph(
    "The present report details the results of the penetration test conducted on the infrastructure and web application of "
    "Client Name during the period from X to Y. The objective was to identify vulnerabilities that could compromise the "
    "security of the client's digital assets."
)
doc.add_paragraph(
    "A total of 10 vulnerabilities were identified, of which 2 are critical, 4 are high severity, and 4 are medium severity."
)
doc.add_paragraph("[Placeholder for graphical summary - Vulnerabilities by Severity]", style='Normal')
doc.add_paragraph(
    "Key Recommendations: Immediate implementation of patches for critical vulnerabilities and a thorough review of access controls "
    "to mitigate high-severity vulnerabilities."
)
doc.add_page_break()

# Methodology
doc.add_heading('Methodology', level=1)
doc.add_paragraph(
    "The pentest was conducted following the classic phases of reconnaissance, vulnerability analysis, exploitation, and reporting. "
    "Tools such as Nmap, Burp Suite, and Metasploit were used to identify and exploit vulnerabilities."
)
doc.add_paragraph(
    "Scope: The evaluation included web servers, internal network infrastructure, and services exposed to the internet."
)
doc.add_paragraph(
    "Limitations: The scope did not include the evaluation of mobile applications or third-party infrastructure."
)
doc.add_page_break()

# Findings and Vulnerabilities
doc.add_heading('Findings and Vulnerabilities', level=1)
doc.add_paragraph('Vulnerability #1: SQL Injection')
doc.add_paragraph(
    "Description: A SQL injection vulnerability was found in the 'userID' parameter in the '/login' URL. This allows the execution "
    "of unauthorized SQL queries."
)
doc.add_paragraph(
    "Impact: An attacker could gain access to the database and extract sensitive information."
)
doc.add_paragraph(
    "Proof of Concept (PoC): The following query was successfully injected: admin' OR '1'='1."
)
doc.add_paragraph("[Placeholder for screenshot/evidence]", style='Normal')
doc.add_paragraph(
    "Repeat for each vulnerability..."
)
doc.add_page_break()

# Impact of Vulnerabilities
doc.add_heading('Impact of Vulnerabilities', level=1)
doc.add_paragraph(
    "The critical vulnerabilities found could result in the exfiltration of confidential data such as user credentials and financial records. "
    "Such a breach could lead to regulatory penalties and loss of trust from customers."
)
doc.add_paragraph(
    "The high-severity vulnerabilities, such as misconfigurations in firewalls, could allow attackers unauthorized access to the internal network, "
    "compromising the integrity of internal systems."
)
doc.add_page_break()

# Recommendations
doc.add_heading('Recommendations', level=1)
doc.add_paragraph(
    "For Vulnerability #1 (SQL Injection): Implement prepared statements and use an Object-Relational Mapping (ORM) framework to handle database "
    "interactions, preventing SQL injection."
)
doc.add_paragraph(
    "For Vulnerability #2 (Brute Force Login): Implement an account lockout system after several failed login attempts and enable multi-factor authentication."
)
doc.add_page_break()

# Conclusion
doc.add_heading('Conclusion', level=1)
doc.add_paragraph(
    "The analysis revealed several critical and high-severity vulnerabilities that must be addressed immediately. Implementing the provided recommendations will mitigate these risks. "
    "It is suggested to perform a follow-up assessment after 3 months to ensure that the corrective measures have been effective."
)
doc.add_paragraph(
    "Continuous improvement in the security posture of Client Name will be essential to protect digital assets and maintain user trust."
)
doc.add_page_break()

# Contact Information
doc.add_heading('Contact Information', level=1)
doc.add_paragraph('Pentester email')

# Appendices
doc.add_heading('Appendices (if applicable)', level=1)
doc.add_paragraph("[Placeholder for additional documentation, logs, screenshots, etc.]")

# Save the document
file_path = "/mnt/data/Pentest_Report_Template.docx"
doc.save(file_path)

file_path
